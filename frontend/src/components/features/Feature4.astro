---
// foundations
import Text from "@/components/foundations/elements/Text.astro";
import Link from "@/components/foundations/elements/Link.astro";
import Wrapper from "@/components/foundations/containers/Wrapper.astro";
import PortableText from "@/components/foundations/elements/PortableText.astro";
import LucideIcon from "@/components/foundations/elements/LucideIcon.astro";
import SanityImage from "@/components/foundations/elements/SanityImage.astro";
import { type AllowedIcon } from "@/data/constants";

interface Props {
  feature?: {
    header?: string;
    subheading?: any[];
    firstFeature?: {
      icon: string;
      title: string;
      description: any[];
      ctaLabel?: string;
      ctaHref?: string;
      imagePosition: "left" | "right";
      image?: {
        asset?: { _ref?: string };
        assetAltText?: string;
        alt?: string;
      };
    };
  };
}

const { feature } = Astro.props;
const { header, subheading, firstFeature } = feature || {};

// Don't render if no feature data
if (!feature || !firstFeature) {
  return null;
}

const isImageLeft = firstFeature.imagePosition === "left";
---

<section class="feature-4">
  <Wrapper variant="standard" class="py-12 border-t">
    {header && (
      <div class="text-center text-balance mb-12">
        <Text
          tag="h2"
          variant="displaySM"
          class="font-serif font-medium tracking-tight brand-heading-color feature-header"
        >
          {header}
        </Text>
        {subheading && (
          <div class="max-w-xl mx-auto mt-4 brand-text-color feature-subheading">
            <PortableText value={subheading} />
          </div>
        )}
      </div>
    )}

    {firstFeature && (
      <div class="items-end grid grid-cols-1 md:grid-cols-2 gap-12 feature-first">
        {isImageLeft && (
          <div class="feature-visual flex h-full order-2 md:order-1">
            {firstFeature.image?.asset?._ref ? (
              <SanityImage
                image={firstFeature.image}
                class="w-full h-auto max-h-[300px]  md:aspect-[5/3] md:w-full lg:aspect-[3/5] lg:h-full lg:object-cover rounded-xl shadow-sm object-cover"
              />
            ) : (
              <div class="w-full h-64 md:h-auto md:aspect-[5/3] md:w-full lg:aspect-[3/5] lg:h-full bg-sand-100 rounded-xl flex items-center justify-center">
                <p class="text-sand-500">Image placeholder</p>
              </div>
            )}
          </div>
        )}
        
        <div class="flex flex-col fit-content text-balance gap-10 order-1 md:order-2">
          <div class="inline-flex p-4 rounded-lg bg-sand-100 w-fit feature-icon">
            <LucideIcon icon={firstFeature.icon as AllowedIcon} size="base" class="text-neutral-700" />
          </div>
          <div>
            <Text
              tag="h2"
              variant="displaySM"
              class="font-serif font-medium tracking-tight brand-heading-color feature-title"
            >
              {firstFeature.title}
            </Text>
            <div class="max-w-xl mt-4 brand-text-color feature-description">
              <PortableText value={firstFeature.description} class="whitespace-pre-line" />
            </div>
            {firstFeature.ctaLabel && firstFeature.ctaHref && (
              <div class="flex mt-4">
                <Link size="sm" variant="accent" href={firstFeature.ctaHref}>{firstFeature.ctaLabel}</Link>
              </div>
            )}
          </div>
        </div>

        {!isImageLeft && (
          <div class="feature-visual flex h-full order-2">
            {firstFeature.image?.asset?._ref ? (
              <SanityImage
                image={firstFeature.image}
                class="w-full h-auto max-h-[300px]  md:aspect-[5/3] md:w-full lg:aspect-[3/5] lg:h-full lg:object-cover rounded-xl shadow-sm object-cover"
              />
            ) : (
              <div class="w-full h-64 md:h-auto md:aspect-[5/3] md:w-full lg:aspect-[3/5] lg:h-full bg-sand-100 rounded-xl flex items-center justify-center">
                <p class="text-sand-500">Image placeholder</p>
              </div>
            )}
          </div>
        )}
      </div>
    )}
  </Wrapper>
</section>
